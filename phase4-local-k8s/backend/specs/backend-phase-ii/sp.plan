# Phase II Backend Implementation Plan - Hackathon II Todo App

## Overview
This plan provides a beginner-friendly roadmap to implement the backend for the Hackathon II Todo App. The implementation will strictly follow the requirements defined in the backend specification (sp.specify) and backend constitution. This plan outlines clear, sequential tasks to guide the development process using simple language and actionable steps.

## Stepwise Implementation Tasks

### 1. Project structure setup
- Ensure backend folder exists at fullstackwebapp/backend
- Create placeholder files:
  - main.py - Application entry point
  - routes/ directory - API route handlers
  - models.py - Data models definitions
  - db.py - Database connection and configuration
  - history/ directory - For prompt history recording

### 2. Database connection
- Configure connection to Neon PostgreSQL using DATABASE_URL environment variable
- Implement database configuration using SQLModel as the ORM
- Ensure all CRUD operations have proper database access methods
- Create database session management utilities

### 3. Authentication & JWT
- Implement middleware to extract JWT from Authorization header (Bearer scheme)
- Verify JWT signature using BETTER_AUTH_SECRET environment variable
- Decode user identity (user_id, email) from JWT payload for request validation
- Ensure all protected endpoints reject requests without valid token (return 401 Unauthorized)

### 4. Task CRUD Endpoints
- Define route placeholders for task operations:
  - GET /api/tasks - List authenticated user's tasks
  - POST /api/tasks - Create new task for authenticated user
  - GET /api/tasks/{id} - Get specific task by ID
  - PUT /api/tasks/{id} - Update specific task
  - DELETE /api/tasks/{id} - Delete specific task
  - PATCH /api/tasks/{id}/complete - Toggle task completion status
- Implement ownership validation to ensure users only access their own tasks
- Require authentication for all task operations
- Implement input validation for all endpoints

### 5. Data integrity and error handling
- Validate all inputs (ensure title is provided, etc.)
- Enforce ownership validation on all update and delete operations
- Implement proper error handling with appropriate HTTP status codes:
  - 401 → Unauthorized (missing or invalid authentication)
  - 403 → Forbidden (authenticated but unauthorized access)
  - 404 → Not Found (resource does not exist)
  - 400 → Bad Request (invalid input data)

### 6. Testing and iteration
- Add unit test placeholders for each major function
- Create integration test plan for API endpoints
- Ensure tasks cannot be accessed across different users
- Implement validation to prevent cross-user data access

## Dependencies & Reusable Components
- Reference reusable agents and skills available in the root .claude folder
- Utilize the Todo Domain Skill for consistent task rules and behaviors
- Apply the Hackathon Guard agent for security checks and validation
- Ensure all backend implementation strictly aligns with the defined specification

## Constraints
- No frontend or UI code should be developed as part of this backend plan
- This plan focuses on creating structure and placeholders, not detailed endpoint implementations
- All instructions should remain beginner-friendly and actionable
- All implementation must comply with the backend constitution and specification

## Prompt History Recording (PHR)
- Automatically create PHR entry for this command
- Save location: fullstackwebapp/backend/history/prompts/
- Include:
  - Command used
  - Intent description
  - Full original prompt text in a code block
  - Note: "PHR recorded automatically as per backend constitution"