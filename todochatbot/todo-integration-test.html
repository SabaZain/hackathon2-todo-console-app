<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo App with Chatbot Integration Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .header {
            background-color: #4CAF50;
            color: white;
            padding: 15px;
            text-align: center;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .todo-container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: 0 auto;
        }

        .todo-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
        }

        .todo-item:last-child {
            border-bottom: none;
        }

        .todo-checkbox {
            margin-right: 10px;
        }

        .todo-text {
            flex-grow: 1;
        }

        .completed {
            text-decoration: line-through;
            color: #888;
        }

        .add-todo {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }

        .add-todo input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .add-todo button {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .add-todo button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Todo App with Integrated Chatbot</h1>
        <p>Your AI-powered task assistant is ready to help!</p>
    </div>

    <div class="todo-container">
        <h2>My Tasks</h2>

        <div class="todo-item">
            <input type="checkbox" class="todo-checkbox" checked>
            <span class="todo-text completed">Complete project proposal</span>
        </div>

        <div class="todo-item">
            <input type="checkbox" class="todo-checkbox">
            <span class="todo-text">Schedule team meeting</span>
        </div>

        <div class="todo-item">
            <input type="checkbox" class="todo-checkbox">
            <span class="todo-text">Review quarterly reports</span>
        </div>

        <div class="todo-item">
            <input type="checkbox" class="todo-checkbox">
            <span class="todo-text">Prepare presentation slides</span>
        </div>

        <div class="add-todo">
            <input type="text" placeholder="Add a new task...">
            <button>Add Task</button>
        </div>
    </div>

    <!-- Chatbot integration -->
    <script>
        // Simulate that the backend is running for testing purposes
        // In a real scenario, this would connect to http://127.0.0.1:8000/api
        console.log("Todo app loaded with chatbot integration capability");

        // Set a mock JWT token for testing
        localStorage.setItem('auth_token', 'mock-jwt-token-for-testing');
        localStorage.setItem('todo_user_id', 'test-user-123');

        // Configure API client when it's available
        window.addEventListener('load', function() {
            setTimeout(function() {
                if (window.TodoAPIClient) {
                    // Configure the API client to point to the backend
                    window.TodoAPIClient.baseURL = 'http://127.0.0.1:8000/api';

                    // Set auth token
                    window.TodoAPIClient.setAuthToken('mock-jwt-token-for-testing');

                    console.log("TodoAPIClient configured to connect to http://127.0.0.1:8000/api");
                } else {
                    console.log("TodoAPIClient not yet available, will configure when loaded");
                }
            }, 2000); // Wait a bit for all components to load
        });
    </script>

    <!-- Load the chatbot integration script -->
    <script src="./embed-chatbot.js"></script>

    <script>
        // Additional configuration after chatbot is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log("Chatbot integration initiated");

            // Check if components are loaded
            setTimeout(function() {
                const checks = [
                    { name: 'TodoAPIClient', exists: typeof window.TodoAPIClient !== 'undefined' },
                    { name: 'TodoChatIcon', exists: typeof window.TodoChatIcon !== 'undefined' },
                    { name: 'TodoChatInterface', exists: typeof window.TodoChatInterface !== 'undefined' },
                    { name: 'TodoMessageSender', exists: typeof window.TodoMessageSender !== 'undefined' }
                ];

                console.log("Component availability check:");
                checks.forEach(check => {
                    console.log(`  ${check.name}: ${check.exists ? '‚úì' : '‚úó'}`);
                });

                const allLoaded = checks.every(check => check.exists);
                if (allLoaded) {
                    console.log("üéâ All chatbot components loaded successfully!");
                    console.log("üí° Chat icon should appear at bottom-right of screen");
                    console.log("üí° Click the icon to open the chat interface");
                } else {
                    console.log("‚ö†Ô∏è Some components failed to load");
                }
            }, 3000); // Wait for all components to initialize
        });
    </script>
</body>
</html>